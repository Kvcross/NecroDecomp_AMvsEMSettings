Necromass MANE HTS Data Processing
October 18, 2018
Peter Kennedy

This project is a collaboration with Katie Beidler and Rich Phillips at IU and myself, Erin Andrews, and Craig See at UMN.  For the molecular analyses of the project, we focused on a subset of the necromass samples that were incubated in the field.  Specifically, we only analyzed the samples from Katie's (Temperate Forest) and Erin's incubations (Oak Savanna).  For these, we also only analyzed the same type of necromass in both locations - i.e. the black morph of Meliniomyces bicolor (MB) and Mortierella elongata (ME).  

DNA extractions were conducted using Qiagen Powersoil kits at IU and UMN respectively.  The HTS library prep was done at UMN for both set of samples.  For each sample, both ITS and 16S primers were used - for ITS we used the ITS2 primer pair from Taylor et al. (2016) AEM and for 16S we use the standard 515F and 806R primer pair. The reaction reagents and cycling conditions followed the two-step Illumina MiSeq protocol used by the Fukami lab at Stanford (see file 2step_ILL_PCRTemplate_BAC.xlsx and 2step_ILL_PCRTemplate_FUN.xlsx for details). If initial PCRs were not successful, we tried with either dilutions or increased cycle numbers. Amanda Certano ran all the final PCRs and did the PCR clean-up following manufacturer's instructions with the Charm clean up kit.  Her notebook contains all the details on library prep and submission.  Successful bacterial and fungal amplicons for each sample were pooled at ~equimolar concentration and sequenced together on a full MiSeq lane at the UMGC in summer 2018.  I think it was V3 chemistry (2 x 300 bp), but can double-check.

Via MSI, the UMGC provided access to the .fastaq files in the folder entitled Kennedy_Project15 (/nfs/roc/data_release/1/umgc/kennedyp/miseq/180716_M00784_0173_000000000-BVJHM/Kennedy_Project_015). I transferred the bacterial and fungal .fastq files into separate folders (BAC: /nfs/roc/groups/5/kennedyp/shared/Projects/Necromass_MANE_Bacteria, FUN: /nfs/roc/groups/5/kennedyp/shared/Projects/Necromass_MANE_Fungi). 

Both the bacterial and fungal samples included positive and negative controls.  For the positive controls, we included the Human Microbiome Project mock we got from the UMGC for the bacteria and the Synthetic mock community of Palmer et al. (2018) for the fungi.  For the negative controls, we ran PCR reactions with no DNA template added.  We pooled those under the same barcode for bacteria and fungi respectively.  Finally, we also sequenced MB and ME necromass that was not deployed in the field for both bacteria and fungi.      

To generate the OTU x sample matrices for the bacterial and fungal HTS datasets, I used the amptk pipeline (v1.1) of Palmer et al. (2018).  See the "amptk_Necromass_MANE_bacteria_unoise3.sh" and "amptk_Necromass_MANE_Fungi_unoise3.sh" file for the details. For denoising step, I used the UNOISE3 algorithm, which is similar to the DADA2 method and, in preliminary analyses, did the best job of capturing the cleanest SymMock samples. Since I did not have access to the sequences for the HMP, I applied a 0.0005 abundance cut-off to the bacterial data to eliminate very low abundance OTUs that are often spurious.  For the fungal data, I used the Synmock abundances to determine the filtering threshold.  Details about both of these specific steps and the broader amptk pipeline can be found at https://amptk.readthedocs.io/en/latest/index.html (I primarily went with the default settings).  Since amptk has a step that can provide functional assignments with FUNGuild, I used that to generate the fungal final raw OTU table.  For bacteria that table is entitled "miseq.cluster.otu_table.taxonomy_BAC.txt" and for fungi it is entitled "miseq.cluster.guilds_FUN.txt".  

#Negative controls and Mock community - BACTERIA
For the bacterial and fungal samples, there were negative controls for both Katie's (1 - I think an extraction control) and Erin's samples (2 - I think one was an extraction control and the other was a PCR control). For the bacterial samples, I looked at the HMP sample in terms of OTUs found versus those expected.  The taxonomy was not particularly closely matching at the species level (i.e. E. coli in the mock was E. fergusonii in the OTU table), but patterns were closer at the genus level.  For the 21 OTUs in the mock, 16 of the 21 were present (76%).  Read counts ranged from 12862 to 4 reads, with the vast majority being zero (I assume the transtion from 4 directly to 0 is the result of the 0.0005 cut-off applied in amptk).  There were some species in the negative controls that showed up in the mock (assumed to be due to index bleed), particularly Rastonia and Methylobacterium.   Considering all this. I decided to take an average of the 3 negative controls and use that as the value against which to subtract sequence reads from the actual samples as in Nguyen et al. (2015).  This had the biggest effect on OTU1 - E. fergusonsii. Because it was highly abundant in the extraction control of Erin's, it actually was eliminated that OTU from the mock following subtraction.  That said, this method eliminated Rastonia and Mehtylbacterium and overall I still think this represents the best approach in terms of trying to eliminate spurious read counts.  I used the formula in Excel: =IF(B2>$GC2, B2-$GC2, 0).  The resulting sequence values were pasted into a new OTU table in a new sheet titled "otu_table.NoNC"

There was also a large gap between most of the mock OTUs in terms of read counts and Enterococcus.  That OTU had 7 reads, while the next lowest was at 39 reads (see file "BAC_NegControl&MockProcessing.xlsx"), with lots of species not present in the mock community in between.  If Enterococcus was missing, I would consider all sequence counts below 39 to the suspect, but to be conservative and keep Enterococcus in, I think that zeroing all cells with 6 sequences or less is the best way to account for this gap.  In Excel, I used the formula: =IF(B2>=6, B2, 0). The abundance adjusted OTU table was pasted into a new sheet titled "otu_table.NoNCNo6".  

#Eliminating ghost OTUs - BACTERIA
With the adjustment for the negative controls and the mock community patterns, there are a number (~200) of the 3131 OTUs that now have 0 total sequences.  To eliminate those and set the final OTU table for ecological analyses, I first summed all the columns in a new column SeqSum.  I then added an Order column to keep the order from the raw table.  Next, sorted the SeqSum column by abundance and pasted all the rows with non-zero totals into a new sheet titled "otu_table.count".  I reordered the columns by their original order using the "Order" column and then deleted the Order column.  

#Normalizing read counts - BACTERIA
There was notable variation in the total number of sequences per sample for the bacterial dataset (range: 865-94671).  To address this variation, I tried to two different approaches. The first is normalizing the data by making the read values proportional to each sample sum (i.e. individual cell values within a column are converted some value between 0 to 1, with the sum of the column = 1).  To do this, in Excel, I first summed each column and then I used the formula: =B2/B$2915 to calculate the proportional values The proportionalized data is in a new sheet titled "otu_table.relabund".  The second approach uses centered log ratios (CLR). The CLR data is based on log of the individual counts compared to the mean count per sample, with a small fudge factor to be able to account for zeros in many of the individual cells.  I used code from Gabe Al-Ghalith to run this calculation in R and then pasted the output back into a new sheet entitled "otu_table.CLR".

#Negative controls and Mock community - FUNGI
Since the mock community correction is already applied in amptk, for the fungal otu table finalization, I only examined the negative controls. The extraction control was missing from the fungal dataset for reasons I am not clear on. The values in the negative controls were also notable lower (in the 1-5 sequence read range, with many zeros), maybe a product of the SynMock filtering being stronger than the filter applied to the bacterial data.  There turned out to be no ghost OTUs following the subtraction of the negative controls. However there was one OTU with 1 read total and the next closest was with 8 or more. For consistency between the bacterial and fungal analyses, I made a new sheet entitled "otu_table.NoNCNo7" that eliminated the one singleton OTU.

#Low abundance samples and Normalizing read counts - FUNGI
In looking through the sequence sums for each fungal sample, a handful had very low totals (<15 total sequence reads).  Given their much lower values relative to all the other fungal samples, I decided that they should be eliminated from the final analyses.  3 were from Katie's samples (#48, 65, 88) and 9 from Erin's (samples 195, 256-263).  The final otu table for the ecological analyses has those eliminated and is labeled "otu_table.count".  There was notable variation in the total number of sequences per sample for the fungal dataset even after this adjustment (range: 212-81319). So, as with the bacteria, I also did proportional transformations ("otu_table.relabund") and CLRs ("otu_table.CLR").
 